{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Liher Fashion - Envío</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="{% static 'css/datosEnvio.css' %}">
<link rel="stylesheet" href="{% static 'css/carrito.css' %}">
</head>
<body>
    <!-- Header -->
    <header class="encabezado">
        <div class="logo">
            <img src="{% static 'Img/1.png' %}" alt="Logo de Liher Fashion">
            <span>Liher Fashion</span>
        </div>

        <div class="progreso-compra">
            <div class="paso-compra">
                <div class="icono-paso"><i class="fas fa-shopping-cart"></i></div>
                <span>Carrito</span>
            </div>
            <div class="linea-progreso"></div>

            <div class="paso-compra">
                <div class="icono-paso"><i class="fas fa-user"></i></div>
                <span>Identificación</span>
            </div>
            <div class="linea-progreso"></div>

            <div class="paso-compra activo">
                <div class="icono-paso"><i class="fas fa-truck"></i></div>
                <span>Entrega</span>
            </div>
            <div class="linea-progreso"></div>

            <div class="paso-compra">
                <div class="icono-paso"><i class="fas fa-credit-card"></i></div>
                <span>Pago</span>
            </div>
        </div>
    </header>

    <!-- Barra rosa decorativa -->
    <div class="pink-banner"></div>

    <!-- Contenedor principal -->
    <div class="contenedor-principal">
        <!-- Columna izquierda: Identificación y Envío -->
        <div class="columna-izquierda">
            <!-- Tarjeta de Identificación -->
            <div class="tarjeta-identificacion">
                <div class="identificacion-header">
                    <h3><i class="fas fa-id-card"></i> Identificación</h3>
                    <a href="{% url 'identificacion' %}" class="boton-editar-perfil">Editar Perfil</a>
                </div>
                {% if identificacion %}
                    <div class="identificacion-info">
                        <p><strong>Correo:</strong> {{ identificacion.email }}</p>
                        <p><strong>Nombre:</strong> {{ identificacion.nombre }} {{ identificacion.apellido }}</p>
                        <p><strong>Contacto:</strong> {{ identificacion.celular }}</p>
                    </div>
                {% else %}
                    <p>No hay información de identificación disponible.</p>
                    <a href="{% url 'identificacion' %}" class="boton-editar">Completar Identificación</a>
                {% endif %}
            </div>

            <!-- Formulario de Envío -->
            <div class="tarjeta-envio">
                <h3>Envío</h3>
                
                <!-- Mostrar mensajes -->
                {% if messages %}
                    <div class="messages">
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}

                <form method="POST" id="form-envio">
                    {% csrf_token %}
                    
                    <!-- Fila 1: Departamento y Municipio -->
                    <div class="fila-form">
                        <div class="campo-form mitad">
                            <label>*Departamento</label>
                            {{ form.departamento }}
                            {% if form.departamento.errors %}
                                <span class="error-texto">{{ form.departamento.errors.0 }}</span>
                            {% endif %}
                        </div>
                        <div class="campo-form mitad">
                            <label>*Municipio o ciudad capital</label>
                            {{ form.municipio }}
                            {% if form.municipio.errors %}
                                <span class="error-texto">{{ form.municipio.errors.0 }}</span>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Fila 2: Dirección completa -->
                    <div class="fila-form">
                        <div class="campo-form quinta-parte">
                            <label>*Tipo de dirección</label>
                            {{ form.tipo_direccion }}
                            {% if form.tipo_direccion.errors %}
                                <span class="error-texto">{{ form.tipo_direccion.errors.0 }}</span>
                            {% endif %}
                        </div>
                        <div class="campo-form quinta-parte">
                            <label>*Calle</label>
                            {{ form.calle }}
                            {% if form.calle.errors %}
                                <span class="error-texto">{{ form.calle.errors.0 }}</span>
                            {% endif %}
                        </div>
                        <div class="campo-form quinta-parte">
                            <label>*Letra</label>
                            {{ form.letra }}
                        </div>
                        <div class="campo-form quinta-parte">
                            <label>*Número</label>
                            {{ form.numero }}
                            {% if form.numero.errors %}
                                <span class="error-texto">{{ form.numero.errors.0 }}</span>
                            {% endif %}
                        </div>
                        <div class="campo-form quinta-parte">
                            <label>-</label>
                            {{ form.adicional }}
                        </div>
                    </div>

                    <!-- Fila 3: Barrio, Piso/Apto y Nombre Receptor -->
                    <div class="fila-form">
                        <div class="campo-form tercio">
                            <label>*Barrio</label>
                            {{ form.barrio }}
                            {% if form.barrio.errors %}
                                <span class="error-texto">{{ form.barrio.errors.0 }}</span>
                            {% endif %}
                        </div>
                        <div class="campo-form tercio">
                            <label>Piso/Apartamento/Torre/Edificio</label>
                            {{ form.piso_apartamento }}
                        </div>
                        <div class="campo-form tercio">
                            <label>*Nombre de la persona que recibe</label>
                            {{ form.nombre_receptor }}
                            {% if form.nombre_receptor.errors %}
                                <span class="error-texto">{{ form.nombre_receptor.errors.0 }}</span>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Empresa de envío -->
                    <div class="seccion-empresa-envio">
                        <label class="label-empresa">Seleccione empresa de envío</label>
                        <div class="opciones-radio">
                            {% for radio in form.empresa_envio %}
                                <label class="radio-opcion">
                                    {{ radio.tag }}
                                    <span class="radio-texto">
                                        {{ radio.choice_label }}:
                                        {% if radio.data.value == 'coordinadora' %}
                                            $12,000
                                        {% elif radio.data.value == 'interrapidisimo' %}
                                            $15,000
                                        {% elif radio.data.value == 'envia' %}
                                            $15,000
                                        {% endif %}
                                    </span>
                                </label>
                            {% endfor %}
                        </div>
                        {% if form.empresa_envio.errors %}
                            <span class="error-texto">{{ form.empresa_envio.errors.0 }}</span>
                        {% endif %}
                    </div>

                    <!-- Nota informativa -->
                    <p class="nota-informativa">
                        Una vez realizado el pago no será posible modificar la dirección o punto de envío.
                    </p>
                </form>
            </div>
        </div>

        <!-- Columna derecha: Resumen de compra -->
        <aside class="columna-derecha">
            <!-- Cupón de descuento -->
            <div class="seccion-cupon">
                <label class="titulo-cupon">Ingresar cupón de descuento</label>
                <div class="input-cupon-group">
                    <input type="text" placeholder="Cupón de descuento" class="input-cupon">
                    <button class="boton-aplicar-cupon">Aplicar</button>
                </div>
            </div>

            <!-- Resumen de precios -->
            <div class="seccion-resumen">
                <div class="linea-resumen">
                    <span>Subtotal:</span>
                    <span id="subtotal-valor">${{ subtotal|floatformat:0 }}</span>
                </div>
                <div class="linea-resumen">
                    <span>Descuento en productos:</span>
                    <span>0</span>
                </div>
                <div class="linea-resumen">
                    <span>Costo de envío:</span>
                    <span id="costo-envio-valor">${{ costo_envio|floatformat:0 }}</span>
                </div>
                <div class="linea-total">
                    <span>Total</span>
                    <span id="total-valor">${{ total|floatformat:0 }}</span>
                </div>
            </div>

            <!-- Botones de acción -->
            <button type="submit" form="form-envio" class="boton-ir-pagar">IR A PAGAR</button>
            <a href="{% url 'carrito' %}" class="boton-volver-carrito">VOLVER AL CARRITO</a>
        </aside>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('form-envio');
            const radios = document.querySelectorAll('input[name="empresa_envio"]');
            const costoEnvioElement = document.getElementById('costo-envio-valor');
            const totalElement = document.getElementById('total-valor');
            const subtotal = {{ subtotal|default:0 }};

            // Actualizar costo de envío
            radios.forEach(radio => {
                radio.addEventListener('change', function() {
                    const costos = {
                        'coordinadora': 12000,
                        'interrapidisimo': 15000,
                        'envia': 15000
                    };
                    
                    const costo = costos[this.value] || 12000;
                    const total = subtotal + costo;
                    
                    costoEnvioElement.textContent = '$' + costo.toLocaleString('es-CO');
                    totalElement.textContent = '$' + total.toLocaleString('es-CO');
                });
            });
        });
    </script>
</body>
</html>