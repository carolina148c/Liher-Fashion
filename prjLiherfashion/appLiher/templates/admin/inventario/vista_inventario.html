{% extends 'admin/includes/base_admin.html' %}
{% load static %}

{% block title %}Inventario{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/secciones_admin.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
{% endblock %}

{% block header_title %}INVENTARIO{% endblock %}

{% block main_content %}
<div class="container">

    {% if total_productos > 0 %}
    <p style="color: #7f8c8d; margin-bottom: 25px; font-size: 15px;">
        Administra todos los productos de tu inventario desde un solo lugar. 
        <strong>{{ total_productos }}</strong> producto{{ total_productos|pluralize }} registrado{{ total_productos|pluralize }}
    </p>
    {% endif %}

    <div class="stats">
        <div class="stat-item stat-total">
            <div class="stat-icon">
                <svg width="24" height="24" ...></svg>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ total_productos }}</div>
                <div class="stat-label">Total Productos</div>
            </div>
        </div>

        <div class="stat-item stat-active">
            <div class="stat-icon">
                <svg width="24" height="24" ...></svg>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ productos_activos }}</div>
                <div class="stat-label">Con Variantes</div>
            </div>
        </div>

        <div class="stat-item stat-inactive">
            <div class="stat-icon">
                <svg width="24" height="24" ...></svg>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ productos_inactivos }}</div>
                <div class="stat-label">Sin Variantes</div>
            </div>
        </div>

        <div class="stat-item inventory-quantity">
            <div class="stat-icon">
                <svg width="24" height="24" ...></svg>
            </div>
            <div class="stat-content">
                <div class="stat-number">{{ total_variantes }}</div>
                <div class="stat-label">Total Variantes</div>
            </div>
        </div>
    </div>

    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li class="{{ message.tags }}">{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <div class="action-buttons">
        <a href="{% url 'agregar_producto' %}" class="btn-primary">
            <svg width="18" height="18" ...></svg>
            Agregar Producto
        </a>

        <a href="{% url 'configuracion_inventario' %}" class="btn btn-primary">
        Configuración de Inventario
        </a>

    </div>

    <div class="table-container">

        {% if productos %}
        <table class="products-table">
            <thead>
                <tr>
                    <th>Producto</th>
                    <th>Referencia</th>
                    <th>Variantes</th>
                    <th>Categoría</th>
                    <th>Precio</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>

            <tbody>
                {% for producto in productos %}
                <tr>

                    <!-- PRODUCTO -->
                <td>
                    <div class="product-cell">
                        <div class="product-image" title="Click para ampliar imagen">
                            {% if producto.imagen %}
                                <img src="{{ producto.imagen.url }}" 
                                    alt="{{ producto.nombre }}"
                                    loading="lazy">
                            {% else %}
                                <img src="{% static 'img/no_image.png' %}" 
                                    alt="Sin imagen"
                                    loading="lazy">
                            {% endif %}
                        </div>
                        <div class="product-info">
                            <div class="product-name">{{ producto.nombre }}</div>
                        </div>
                    </div>
                </td>

                    <!-- REFERENCIA -->
                    <td>
                        <span style="color: #7f8c8d; font-weight: 500;">
                            {{ producto.referencia|default:"—" }}
                        </span>
                    </td>

                    <!-- VARIANTES -->
                    <td>
                        <span class="status-badge status-shipped">
                            {{ producto.n_variantes }} variante{{ producto.n_variantes|pluralize }}
                            {% if producto.total_stock %}
                                ({{ producto.total_stock }} unid.)
                            {% endif %}
                        </span>
                    </td>

                    <!-- CATEGORÍA -->
                    <td>{{ producto.categoria.categoria|default:"Sin categoría" }}</td>

                    <!-- PRECIO -->
                    <td>${{ producto.precio }}</td>

                    <!-- ESTADO REAL DEL PRODUCTO -->
                    <td>
                        {% if producto.estado == "Activo" %}
                            <span class="status-badge status-active">
                                ✔ Activo
                            </span>
                        {% else %}
                            <span class="status-badge status-inactive">
                                ✖ Inactivo
                            </span>
                        {% endif %}
                    </td>

                    <!-- ACCIONES-->
                    <td>
                        <div class="table-actions">

                            <a href="{% url 'editar_producto' producto.idproducto %}"
                               class="btn-action" title="Gestionar Variantes"
                               style="background: rgba(156, 39, 176, 0.1); color: #9C27B0;">
                                Variantes
                            </a>

                        </div>
                    </td>

                </tr>
                {% endfor %}
            </tbody>

        </table>

        {% else %}
        <div class="empty-state">
            <h3>No hay productos registrados</h3>
            <p>Comienza agregando tu primer producto al sistema</p>
        </div>
        {% endif %}

    </div>

</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/vista_inventario.js' %}"></script>
{% endblock %}
