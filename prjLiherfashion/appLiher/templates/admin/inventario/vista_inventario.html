{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/vistainventario.css' %}">
    <link rel="stylesheet" href="{% static 'css/vista_inventario.css' %}">
    <title>Inventario de Productos</title>
    <style>

    </style>
</head>
<body>
    <div class="contenedor">
        <aside class="barra-lateral" id="barraSidebar">
            <div class="encabezado-barra">
                Panel Administrador
            </div>
            <ul class="menu-barra">
                <li><a href="{% url 'panel_admin' %}" class="activo"><span class="icono icono-inicio"></span> Inicio</a></li>
                <li><a href="{% url 'listar_productos_tabla' %}"><span class="icono icono-inventario"></span> Inventario</a></li>
                <li><a href="{% url 'listar_productos_catalogo' %}"><span class="icono icono-catalogo"></span> Catálogo</a></li>
                <li><a href="#"><span class="icono icono-pedidos"></span> Pedidos</a></li>
                <li><a href="{% url 'mostrar_usuarios' %}"><span class="icono icono-usuarios"></span> Usuarios</a></li>
                <li><a href="#"><span class="icono icono-devoluciones"></span> Devoluciones</a></li>
                <li><a href="#"><span class="icono icono-peticiones"></span> Peticiones</a></li>
            </ul>
        </aside>

        <div class="overlay" id="overlay"></div>

        <main class="contenido-principal">
            <div class="header">
                <div class="header-title">
                    <div class="burger-icon" id="burgerIcon">
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                    📦 INVENTARIO
                </div>
            </div>

            <div class="main-container">
                <div class="inventory-stats">
                    <div class="inventory-stat-item inventory-total">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="9" y1="9" x2="15" y2="9"></line>
                                <line x1="9" y1="12" x2="15" y2="12"></line>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">{{ total_productos }}</div>
                            <div class="stat-label">Total de productos (SKUs)</div>
                        </div>
                    </div>

                    <div class="inventory-stat-item inventory-quantity">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 12V7l-5-5H3a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10"></path>
                                <polyline points="16 12 11 12 11 17"></polyline>
                                <line x1="15" y1="17" x2="19" y2="17"></line>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">{{ stock_total_unidades }}</div>
                            <div class="stat-label">Stock Total de Unidades</div>
                        </div>
                    </div>
                    
                    <div class="inventory-stat-item inventory-value">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">${{ valor_inventario|floatformat:2 }}</div>
                            <div class="stat-label">Valor inventario</div>
                        </div>
                    </div>

                    <div class="inventory-stat-item inventory-low">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                                <line x1="12" y1="9" x2="12" y2="13"></line>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">{{ productos_stock_bajo }}</div>
                            <div class="stat-label">Stock bajo</div>
                        </div>
                    </div>

                    <div class="inventory-stat-item inventory-out">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="15" y1="9" x2="9" y2="15"></line>
                                <line x1="9" y1="9" x2="15" y2="15"></line>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">{{ productos_agotados }}</div>
                            <div class="stat-label">Productos agotados</div>
                        </div>
                    </div>
                </div>

                <div class="search-filter-container">
                    <div class="search-bar">
                        <input type="text" placeholder="Buscar por nombre, código o referencia..." id="searchInput">
                        <button class="clear-search" id="clearSearch" title="Limpiar búsqueda">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                        <span class="search-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                            </svg>
                        </span>
                    </div>

                    <div class="filter-dropdown">
                        📂 Todas las categorías
                    </div>

                    <div class="filter-dropdown">
                        🎨 Todos los colores
                    </div>

                    <div class="filter-dropdown">
                        📏 Todas las tallas
                    </div>

                    <div class="filter-dropdown">
                        📊 Todos los estados
                    </div>
                </div>

                <!-- Información de resultados de búsqueda -->
                <div class="search-results-info" id="searchResultsInfo">
                    <strong id="resultsCount">0</strong> productos encontrados para "<span id="searchTerm"></span>"
                </div>

                <div class="action-buttons">
                    <a href="{% url 'crear_producto' %}" class="btn btn-primary">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Añadir Producto
                    </a>
                </div>

                <div class="table-container">
                    <table class="inventory-table">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Categoría</th>
                                <th>Color</th>
                                <th>Talla</th>
                                <th>Precio</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTableBody">
                            {% for producto in productos %}
                            <tr class="product-row" data-product-name="{{ producto.producto|lower }}" 
                                data-product-id="{{ producto.idinventario }}" 
                                data-category="{{ producto.categoria|lower }}"
                                data-color="{{ producto.color|lower }}"
                                data-size="{{ producto.talla|lower }}"
                                data-status="{{ producto.estado|lower }}">
                                <td>
                                    <div class="product-cell">
                                        <div class="product-image">📦</div>
                                        <div class="product-info">
                                            <div class="product-name">{{ producto.producto }}</div>
                                            <div class="product-id">ID: {{ producto.idinventario }}</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="category-cell">{{ producto.categoria }}</td>
                                <td class="color-cell">{{ producto.color }}</td>
                                <td class="size-cell">{{ producto.talla }}</td>
                                <td><strong>${{ producto.precio|floatformat:2 }}</strong></td>
                                
                                <td>
                                    <span class="status-badge {% if producto.estado == 'agotado' %}status-inactive{% else %}status-active{% endif %}">
                                        {{ producto.estado }}
                                    </span>
                                </td>
                                <td>
                                    <div class="table-actions">
                                        <a href="{% url 'editar_producto' producto.idinventario %}" class="edit-btn">Editar</a>
                                        <form method="post" action="{% url 'eliminar_producto' producto.idinventario %}" style="display: inline;">
                                            {% csrf_token %}
                                            <button type="submit" class="delete-btn" onclick="return confirm('¿Estás seguro de que deseas eliminar este producto?')">Eliminar</button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr class="empty-row">
                                <td colspan="7" style="text-align: center; padding: 40px; color: #7f8c8d;">
                                    <div style="font-size: 48px; margin-bottom: 16px;">📦</div>
                                    <div style="font-size: 18px; font-weight: 600;">No hay productos en el inventario</div>
                                    <div style="font-size: 14px; margin-top: 8px;">Añade tu primer producto para comenzar</div>
                                </td>
                            </tr>
                            {% endfor %}
                            
                            <!-- Mensaje cuando no hay resultados de búsqueda -->
                            <tr class="no-results" id="noResults">
                                <td colspan="7" style="text-align: center; padding: 40px; color: #7f8c8d;">
                                    <div style="font-size: 48px; margin-bottom: 16px;">🔍</div>
                                    <div style="font-size: 18px; font-weight: 600;">No se encontraron productos</div>
                                    <div style="font-size: 14px; margin-top: 8px;">Prueba con diferentes términos de búsqueda</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <script src="{% static 'js/vista_inventario.js' %}"></script>

</body>
</html>