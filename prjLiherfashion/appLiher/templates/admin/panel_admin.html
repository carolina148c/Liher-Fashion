{% extends "admin/includes/base_admin.html" %}
{% load static %}

{% block title %}Panel Administrador{% endblock %}
{% block header_title %}Estadísticas{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/secciones_admin.css' %}">
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

{% endblock %}

{% block main_content %}

<div class="main-container">

    <!-- TARJETAS ESTADÍSTICAS -->
    <div class="stats">

        <div class="stat-item stat-blue">
            <div class="stat-icon"><i class="fas fa-boxes"></i></div>
            <div class="stat-number">{{ total_productos }}</div>
            <div class="stat-label">Total Productos</div>
        </div>

        <div class="stat-item stat-green">
            <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
            <div class="stat-number">{{ productos_activos }}</div>
            <div class="stat-label">Activos</div>
        </div>

        <div class="stat-item stat-red">
            <div class="stat-icon"><i class="fas fa-times-circle"></i></div>
            <div class="stat-number">{{ productos_inactivos }}</div>
            <div class="stat-label">Inactivos</div>
        </div>

        <div class="stat-item stat-purple">
            <div class="stat-icon"><i class="fas fa-tags"></i></div>
            <div class="stat-number">{{ total_variantes }}</div>
            <div class="stat-label">Variantes Totales</div>
        </div>

        <div class="stat-item stat-green">
            <div class="stat-icon"><i class="fas fa-box"></i></div>
            <div class="stat-number">{{ productos_con_stock }}</div>
            <div class="stat-label">Con Stock</div>
        </div>

        <div class="stat-item stat-red">
            <div class="stat-icon"><i class="fas fa-box-open"></i></div>
            <div class="stat-number">{{ productos_sin_stock }}</div>
            <div class="stat-label">Agotados</div>
        </div>

        <div class="stat-item stat-blue">
            <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
            <div class="stat-number">${{ precio_promedio }}</div>
            <div class="stat-label">Precio Promedio</div>
        </div>

        <div class="stat-item stat-orange">
            <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
            <div class="stat-number">${{ valor_inventario }}</div>
            <div class="stat-label">Valor Total Inventario</div>
        </div>

        <div class="stat-item stat-blue">
            <div class="stat-icon"><i class="fas fa-users"></i></div>
            <div class="stat-number">{{ total_usuarios }}</div>
            <div class="stat-label">Total Usuarios</div>
        </div>

        <div class="stat-item stat-green">
            <div class="stat-icon"><i class="fas fa-user-check"></i></div>
            <div class="stat-number">{{ usuarios_activos }}</div>
            <div class="stat-label">Usuarios Activos</div>
        </div>

        <div class="stat-item stat-red">
            <div class="stat-icon"><i class="fas fa-user-slash"></i></div>
            <div class="stat-number">{{ usuarios_inactivos }}</div>
            <div class="stat-label">Usuarios Inactivos</div>
        </div>

    </div>

    <!-- GRÁFICAS DEL DASHBOARD -->
    <div class="charts-container">

        <div class="chart-card">
            <h3>Productos (Activos vs Inactivos)</h3>
            <canvas id="chartProductos"></canvas>
        </div>

        <div class="chart-card">
            <h3>Stock</h3>
            <canvas id="chartStock"></canvas>
        </div>

        <div class="chart-card">
            <h3>Usuarios</h3>
            <canvas id="chartUsuarios"></canvas>
        </div>

    </div>


    <!-- BOTONES -->
    <div class="acciones-dashboard">
        <a href="{% url 'agregar_producto' %}" class="btn-primary">
            <i class="fas fa-plus"></i> Agregar Producto
        </a>

        <button type="button" class="btn-add" onclick="openModal('createUserModal')">
            <i class="fas fa-user-plus"></i> Agregar Usuario
        </button>
    </div>

</div>

<!-- CHART.JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // PRODUCTOS
    new Chart(document.getElementById('chartProductos'), {
        type: 'bar',
        data: {
            labels: ['Activos', 'Inactivos'],
            datasets: [{
                label: 'Productos',
                data: [{{ productos_activos }}, {{ productos_inactivos }}],
                backgroundColor: ['#28c76f', '#ea5455']
            }]
        }
    });

    // STOCK
    new Chart(document.getElementById('chartStock'), {
        type: 'bar',
        data: {
            labels: ['Con Stock', 'Agotados'],
            datasets: [{
                label: 'Stock',
                data: [{{ productos_con_stock }}, {{ productos_sin_stock }}],
                backgroundColor: ['#00cfe8', '#ff9f43']
            }]
        }
    });

    // USUARIOS
    new Chart(document.getElementById('chartUsuarios'), {
        type: 'bar',
        data: {
            labels: ['Activos', 'Inactivos'],
            datasets: [{
                label: 'Usuarios',
                data: [{{ usuarios_activos }}, {{ usuarios_inactivos }}],
                backgroundColor: ['#7367f0', '#ff2e70']
            }]
        }
    });
</script>

{% endblock %}
